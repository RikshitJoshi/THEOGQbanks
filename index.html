<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Medical Question Bank | NEET PG & INI-CET</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
body{background:#020617;color:#e5e7eb}
.card{background:#000;padding:1.5rem;border-radius:1rem;border:1px solid #1f2937;cursor:pointer;position:relative}
.locked{filter:blur(2px)}
.lock-icon{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2rem;background:rgba(0,0,0,.5)}
#loginOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center}
</style>
</head>

<body>
<div id="root"></div>

<!-- LOGIN OVERLAY -->
<div id="loginOverlay">
  <div style="background:black;padding:28px;border-radius:14px;text-align:center">
    <h2 class="text-xl mb-4">Login Required</h2>
    <button onclick="googleLogin()" class="px-6 py-3 bg-cyan-400 text-black font-bold rounded-lg">
      Continue with Google
    </button>
  </div>
</div>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey:"AIzaSyBtoP56S-PH9mr8_HMjl6Vp1-akZBHPv4A",
  authDomain:"og-pirate-login.firebaseapp.com",
  projectId:"og-pirate-login"
});

const auth = firebase.auth();
const db = firebase.firestore();

window.currentUser = null;
window.isPremium = false;

/* üî• SINGLE SOURCE OF TRUTH */
auth.onAuthStateChanged(async user=>{
  const overlay = document.getElementById("loginOverlay");

  if(!user){
    overlay.style.display = "flex";
    window.currentUser = null;
    window.isPremium = false;
    return;
  }

  /* USER LOGGED IN */
  overlay.style.display = "none";
  window.currentUser = user;

  /* PREMIUM CHECK (NO UI TOUCH) */
  const ref = db.collection("users").doc(user.uid);
  const snap = await ref.get();

  if(!snap.exists){
    await ref.set({ email:user.email, createdAt:Date.now() });
    window.isPremium = false;
    return;
  }

  const d = snap.data();
  window.isPremium = d.expiry && Date.now() < d.expiry;
});

/* üîê POPUP LOGIN (MOST STABLE ON GITHUB PAGES) */
function googleLogin(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
    .catch(err=>alert(err.message));
}

/* PAYMENT */
function startPayment(plan){
  const amount = plan==="monthly"?5000:19900;
  const duration = plan==="monthly"?2592000000:31536000000;

  new Razorpay({
    key:"rzp_live_S9L7SGabPrW69z",
    amount,
    currency:"INR",
    handler:async res=>{
      await db.collection("users").doc(currentUser.uid).set({
        email:currentUser.email,
        plan,
        expiry:Date.now()+duration
      },{merge:true});
      alert("Premium Activated");
      location.reload();
    }
  }).open();
}
</script>

<script type="text/babel">
function App(){

const data=[
{title:"1st Year MBBS",free:true,items:[
["ü¶¥","Anatomy","prepX_Anatomy.html"],
["‚ù§Ô∏è","Physiology","PrepX_Physiology.html"],
["üß™","Biochemistry","prepX_Biochemistry.html"]
]},
{title:"Final Year MBBS",free:false,items:[
["ü©∫","Medicine","prepX_Medicine.html"],
["üó°Ô∏è","Surgery","prepX_Surgery.html"],
["üë∂","Pediatrics","prepX_Pediatrics.html"]
]},
{title:"Quizzes",free:false,items:[
["‚ùì","NEET PG Quiz","https://neetpgquizz.netlify.app/"],
["‚ùì","FMGE Quiz","https://fmgequizz.netlify.app/"]
]}
];

function openItem(link,free){
  if(free) return location.href=link;
  if(!window.isPremium){
    const c=prompt("Premium required\nM=‚Çπ50\nY=‚Çπ199");
    if(c==="m") startPayment("monthly");
    if(c==="y") startPayment("yearly");
    return;
  }
  link.startsWith("http")?window.open(link):location.href=link;
}

return(
<div className="max-w-5xl mx-auto p-6">
<h1 className="text-3xl font-bold mb-6 text-center">Medical Question Bank</h1>

{data.map(s=>(
<div key={s.title} className="mb-10">
<h2 className="text-xl mb-4">{s.title}</h2>
<div className="grid md:grid-cols-3 gap-4">
{s.items.map(([i,t,l])=>(
<div key={t} onClick={()=>openItem(l,s.free)}
 className={`card ${s.free?"":"locked"}`}>
<div className="text-3xl">{i}</div>
<div>{t}</div>
{!s.free && <div className="lock-icon">üîí</div>}
</div>
))}
</div>
</div>
))}
</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>

</body>
</html>